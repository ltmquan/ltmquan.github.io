<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Interactive Quiz</title>
  <style>
    :root{--bg:#0f172a;--card:#0b1220;--accent:#7c3aed;--muted:#9aa4b2;--glass:rgba(255,255,255,0.03)}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#041126 0%, #071430 100%);color:#e6eef6;padding:24px}
    .container{width:100%;max-width:900px;background:linear-gradient(180deg,var(--card),#081022);border-radius:12px;padding:28px;box-shadow:0 10px 30px rgba(2,6,23,0.6)}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .meta{color:var(--muted);font-size:13px}
    .quiz-card{background:var(--glass);padding:18px;border-radius:10px}
    .question{font-size:18px;margin:0 0 12px}
    .choices{list-style:none;padding:0;margin:0;display:grid;gap:10px}
    .choice{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:12px;border-radius:8px;cursor:pointer;display:flex;align-items:center;gap:12px}
    .choice input{accent-color:var(--accent)}
    .choice:focus-within{outline:2px solid rgba(124,58,237,0.18)}
    footer{display:flex;justify-content:space-between;align-items:center;margin-top:16px}
    button{background:linear-gradient(90deg,var(--accent),#5b21b6);border:none;color:white;padding:10px 14px;border-radius:8px;cursor:pointer}
    button[disabled]{opacity:0.45;cursor:not-allowed}
    .progress{height:10px;background:rgba(255,255,255,0.04);border-radius:999px;overflow:hidden;flex:1;margin:0 16px}
    .progress > i{display:block;height:100%;background:linear-gradient(90deg,#34d399,#60a5fa);width:0%}
    .small{font-size:13px;color:var(--muted)}
    .result{padding:18px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);margin-top:14px}
    @media (max-width:600px){.container{padding:16px}}
  </style>
</head>
<body>
  <div class="container" role="main">
    <header>
      <div>
        <h1>General Knowledge Quiz</h1>
        <div class="meta">5 questions — multiple choice — accessible</div>
      </div>
      <div class="small">Timer: <span id="timer">--:--</span></div>
    </header>

    <section class="quiz-card" aria-live="polite">
      <div id="quiz-area">
        <!-- Question area rendered by JS -->
      </div>

      <footer>
        <div class="small">Question <span id="current">0</span>/<span id="total">0</span></div>
        <div class="progress" aria-hidden="true"><i id="progress-bar"></i></div>
        <div style="display:flex;gap:8px;align-items:center">
          <button id="prevBtn" aria-label="Previous question">Prev</button>
          <button id="nextBtn" aria-label="Next question">Next</button>
          <button id="submitBtn" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)">Submit</button>
        </div>
      </footer>

      <div id="result" class="result" hidden></div>
    </section>

    <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
      <button id="restart">Restart</button>
      <button id="download">Download HTML</button>
    </div>
  </div>

  <script>
    // ====== Quiz data ======
    const QUIZ = [
      {
        id:1,
        q: 'Which planet is known as the Red Planet?',
        choices: ['Venus','Mars','Jupiter','Mercury'],
        answer: 1
      },
      {
        id:2,
        q: 'What is the capital of Japan?',
        choices: ['Beijing','Seoul','Tokyo','Bangkok'],
        answer: 2
      },
      {
        id:3,
        q: 'Which gas do plants primarily absorb from the atmosphere?',
        choices: ['Oxygen','Nitrogen','Carbon Dioxide','Hydrogen'],
        answer: 2
      },
      {
        id:4,
        q: 'Who wrote the play "Romeo and Juliet"?',
        choices: ['Charles Dickens','William Shakespeare','Leo Tolstoy','Mark Twain'],
        answer: 1
      },
      {
        id:5,
        q: 'What is the chemical symbol for gold?',
        choices: ['Au','Ag','Gd','Go'],
        answer: 0
      }
    ];

    // ====== State ======
    const state = {
      index: 0,
      answers: Array(QUIZ.length).fill(null),
      startTime: null,
      duration: 60 * 3 // 3 minutes timer (seconds)
    };

    // ====== Elements ======
    const quizArea = document.getElementById('quiz-area');
    const currentEl = document.getElementById('current');
    const totalEl = document.getElementById('total');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const submitBtn = document.getElementById('submitBtn');
    const restartBtn = document.getElementById('restart');
    const downloadBtn = document.getElementById('download');
    const progressBar = document.getElementById('progress-bar');
    const resultBox = document.getElementById('result');
    const timerEl = document.getElementById('timer');

    totalEl.textContent = QUIZ.length;

    // ====== Render ======
    function renderQuestion() {
      const item = QUIZ[state.index];
      currentEl.textContent = state.index + 1;
      const selected = state.answers[state.index];

      const html = `
        <h2 class="question">${escapeHtml(item.q)}</h2>
        <ul class="choices" role="radiogroup" aria-labelledby="question-${item.id}">
          ${item.choices.map((c,i)=>`
            <li>
              <label class="choice" tabindex="0">
                <input type="radio" name="choice" value="${i}" ${selected===i? 'checked':''} />
                <span>${escapeHtml(c)}</span>
              </label>
            </li>
          `).join('')}
        </ul>
      `;

      quizArea.innerHTML = html;

      // Attach choice handlers
      quizArea.querySelectorAll('input[name=choice]').forEach(i=>{
        i.addEventListener('change', (e)=>{
          state.answers[state.index] = Number(e.target.value);
          saveProgress();
          updateControls();
        });
      });

      // Keyboard friendly label click
      quizArea.querySelectorAll('.choice').forEach((lbl, idx)=>{
        lbl.addEventListener('keydown', (e)=>{
          if(e.key==='Enter' || e.key===' '){
            const inp = lbl.querySelector('input');
            inp.checked = true;
            inp.dispatchEvent(new Event('change',{bubbles:true}));
            e.preventDefault();
          }
        });
        lbl.addEventListener('click', ()=>{
          const inp = lbl.querySelector('input');
          inp.checked = true;
          inp.dispatchEvent(new Event('change',{bubbles:true}));
        });
      });

      updateProgress();
    }

    function updateProgress(){
      const pct = ((state.index)/ (QUIZ.length)) * 100;
      progressBar.style.width = pct + '%';
    }

    function updateControls(){
      prevBtn.disabled = state.index === 0;
      nextBtn.disabled = state.index === QUIZ.length - 1;
    }

    // ====== Navigation ======
    prevBtn.addEventListener('click', ()=>{ state.index = Math.max(0, state.index - 1); renderQuestion(); updateControls(); });
    nextBtn.addEventListener('click', ()=>{ state.index = Math.min(QUIZ.length-1, state.index + 1); renderQuestion(); updateControls(); });

    submitBtn.addEventListener('click', ()=>{ showResults(); });
    restartBtn.addEventListener('click', ()=>{ if(confirm('Restart the quiz? Your progress will be cleared.')) resetQuiz(); });

    // ====== Timer ======
    let timerInterval = null;
    function startTimer(){
      state.startTime = Date.now();
      clearInterval(timerInterval);
      timerInterval = setInterval(()=>{
        const elapsed = Math.floor((Date.now() - state.startTime) / 1000);
        const remaining = Math.max(0, state.duration - elapsed);
        timerEl.textContent = formatTime(remaining);
        if(remaining<=0){ clearInterval(timerInterval); showResults(true); }
      }, 300);
    }

    // ====== Results ======
    function showResults(auto=false){
      // Score
      let correct = 0;
      const details = QUIZ.map((q,i)=>{
        const isCorrect = state.answers[i] === q.answer;
        if(isCorrect) correct++;
        return {q:q.q, selected: state.answers[i], correct: q.answer, isCorrect};
      });

      const percent = Math.round((correct / QUIZ.length) * 100);
      resultBox.hidden = false;
      resultBox.innerHTML = `\n        <strong>Score: ${correct}/${QUIZ.length} (${percent}%)</strong>\n        <div class="small" style="margin-top:8px">${auto? 'Time expired —' : ''} Review below.</div>\n        <ol style="margin-top:10px;padding-left:18px">\n          ${details.map(d=>`<li style="margin-bottom:8px"><div style=\"font-weight:600\">${escapeHtml(d.q)}</div>\n            <div class=\"small\">Your answer: ${d.selected === null ? '<em>none</em>' : escapeHtml(QUIZ[details.indexOf(d)].choices[d.selected])} — ${d.isCorrect? '<strong style=\"color:#34d399\">Correct</strong>':'<strong style=\"color:#fb7185\">Incorrect</strong> (Correct: '+ escapeHtml(QUIZ[details.indexOf(d)].choices[d.correct]) +')'}</div></li>`).join('')}
        </ol>
        <div style="margin-top:12px"><button id=\"saveResults\">Save to localStorage</button></div>
      `;

      document.getElementById('saveResults').addEventListener('click', ()=>{
        const payload = {score: correct, total: QUIZ.length, percent, answers: state.answers, at: new Date().toISOString()};
        const list = JSON.parse(localStorage.getItem('quiz-results')||'[]');
        list.push(payload);
        localStorage.setItem('quiz-results', JSON.stringify(list));
        alert('Results saved locally.');
      });

      // stop timer
      clearInterval(timerInterval);
    }

    function resetQuiz(){
      state.index = 0; state.answers = Array(QUIZ.length).fill(null); state.startTime = null; resultBox.hidden = true; renderQuestion(); updateControls(); updateProgress(); saveProgress(true); startTimer();
    }

    // ====== Persistence ======
    function saveProgress(forceClear=false){
      if(forceClear){ localStorage.removeItem('quiz-progress'); return; }
      const data = {index: state.index, answers: state.answers, startTime: state.startTime, duration: state.duration};
      localStorage.setItem('quiz-progress', JSON.stringify(data));
    }

    function loadProgress(){
      try{
        const data = JSON.parse(localStorage.getItem('quiz-progress')||'null');
        if(data && Array.isArray(data.answers) && data.answers.length===QUIZ.length){
          state.index = data.index||0; state.answers = data.answers; state.startTime = data.startTime || Date.now(); state.duration = data.duration || state.duration; return true;
        }
      }catch(e){/* ignore */}
      return false;
    }

    // ====== Utilities ======
    function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
    function formatTime(sec){ const m = Math.floor(sec/60); const s = sec%60; return String(m).padStart(2,'0')+ ':' + String(s).padStart(2,'0'); }

    // ====== Download self-contained HTML ======
    downloadBtn.addEventListener('click', ()=>{
      const blob = new Blob([document.documentElement.outerHTML], {type:'text/html'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'interactive-quiz.html'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    // ====== Init ======
    (function init(){
      const had = loadProgress();
      renderQuestion(); updateControls(); updateProgress();
      if(!had) startTimer(); else { // resume timer sensibly
        if(!state.startTime) state.startTime = Date.now(); startTimer();
      }
    })();

    // Make enter/space on next/prev work when focused
    [prevBtn,nextBtn,submitBtn].forEach(b=> b.addEventListener('keyup', e=>{ if(e.key==='Enter' || e.key===' ') b.click(); }));

  </script>
</body>
</html>

